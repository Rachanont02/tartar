<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- iOS icon -->
    <link rel="manifest" href="manifest.json?v=2">
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link href="https://fonts.googleapis.com/css2?family=Playpen+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <title>TarTar</title>

    <!-- PWA -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#EEEFF3">

    <!-- iOS -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="TarTar">
    <link rel="apple-touch-icon" href="icons/icon-192.png">

    <link rel="stylesheet" href="style.css">
  </head>
  <body>
    <header>
      <h1>TarTar ✨</h1>
      <p>บันทึกความทรงจำของคู่เรา และเป็นผู้ช่วยการเดินทาง</p>
    </header>

    <main>
      <section class="card">
        <h2>สถานะแอป</h2>
        <p id="status">กำลังตรวจสอบ...</p>
        <div class="actions">
          <button id="cache-btn">โหลดไฟล์ล่วงหน้า</button>
          <button id="clear-cache-btn">ล้าง cache</button>
        </div>
      </section>

      <section class="card">
        <h2>วิธีติดตั้งบน iOS</h2>
        <ol>
          <li>เปิดหน้านี้ด้วย <strong>Safari</strong></li>
          <li>กด <strong>Share</strong> → <strong>Add to Home Screen</strong></li>
          <li>กด <strong>Add</strong></li>
        </ol>
      </section>
    </main>

    <footer>© 2025 Fillus</footer>
    <script type="module">
      import { listTrips, addTrip } from './api.js';
    
      async function refresh() {
        const status = document.getElementById('status');
        status.textContent = 'กำลังโหลด Trips...';
        try {
          const rows = await listTrips();
          status.textContent = `พบ ${rows.length} ทริป`;
          console.log(rows);
          // TODO: วาดรายการ trips ลง DOM
        } catch (e) {
          status.textContent = 'โหลดข้อมูลไม่สำเร็จ ❌';
          console.error(e);
        }
      }
    
      // ตัวอย่างเพิ่มทริป
      // await addTrip({ title:'Oslo weekend', start_date:'2025-09-10', end_date:'2025-09-12', notes:'คู่เรา' })
      async function testAPI() {
        try {
          // เพิ่มทริปใหม่
          const newId = await addTrip({
            title: "Oslo Weekend",
            start_date: "2025-09-10",
            end_date: "2025-09-12",
            notes: "ลองเพิ่มจาก PWA"
          });
          console.log("เพิ่มสำเร็จ id =", newId);
    
          // โหลดรายการทั้งหมด
          const trips = await listTrips();
          console.log("ทั้งหมด =", trips);
        } catch (err) {
          console.error("API error:", err);
        }
      }

      testAPI();
      refresh();
    </script>
    
  </body>

</html>
