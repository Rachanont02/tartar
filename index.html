<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- iOS icon -->
    <link rel="manifest" href="manifest.json?v=2">
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link href="https://fonts.googleapis.com/css2?family=Playpen+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <title>TarTar</title>

    <!-- PWA -->
    <meta name="theme-color" content="#EEEFF3">

    <!-- iOS -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="TarTar">
    <link rel="apple-touch-icon" href="icons/icon-192.png">

    <link rel="stylesheet" href="style.css">
  </head>
  <body>
    <header>
      <h1>TarTar ✨</h1>
      <p>บันทึกความทรงจำของคู่เรา และเป็นผู้ช่วยการเดินทาง</p>
    </header>

    <main>
      <section class="card">
        <h2>สถานะแอป</h2>
        <p id="status">กำลังตรวจสอบ...</p>
        <div class="actions">
          <button id="cache-btn">โหลดไฟล์ล่วงหน้า</button>
          <button id="clear-cache-btn">ล้าง cache</button>
        </div>
      </section>

      <section class="card">
        <h2>รายการทริป</h2>
        <ul id="trip-list"></ul>
      </section>
    </main>

    <footer>© 2025 Fillus</footer>
    <script type="module">
      import { listTrips, addTrip } from './api.js';
    
      async function refresh() {
        const list = document.getElementById('trip-list');
        list.innerHTML = 'กำลังโหลด...';
        try {
          const rows = await listTrips();
          list.innerHTML = rows.map(r =>
            `<li><b>${r.title}</b> (${r.start_date} → ${r.end_date})<br>${r.notes}</li>`
          ).join('');
        } catch (e) {
          list.innerHTML = 'โหลดไม่สำเร็จ ❌';
          console.error(e);
        }
      }
    
      // ตัวอย่างเพิ่มทริปใหม่ 1 อัน
      async function testAdd() {
        await addTrip({
          title: "Oslo weekend",
          start_date: "2025-09-10",
          end_date: "2025-09-12",
          notes: "ลองเพิ่มจาก PWA"
        });
        await refresh();
      }
    
      // เรียกใช้
      refresh();
      testAdd(); // uncomment ถ้าอยากลองเพิ่มจริง
    </script>
    
  </body>

</html>
